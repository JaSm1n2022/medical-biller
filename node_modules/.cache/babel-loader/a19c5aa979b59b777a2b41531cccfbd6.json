{"ast":null,"code":"import _regeneratorRuntime from \"/Users/nargelmac/Documents/GitHub/medical-biller/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nvar _marked = /*#__PURE__*/_regeneratorRuntime().mark(watchAuth),\n  _marked2 = /*#__PURE__*/_regeneratorRuntime().mark(logoutSaga),\n  _marked3 = /*#__PURE__*/_regeneratorRuntime().mark(checkAuthTimeoutSaga),\n  _marked4 = /*#__PURE__*/_regeneratorRuntime().mark(authUserSaga),\n  _marked5 = /*#__PURE__*/_regeneratorRuntime().mark(authCheckStateSaga);\nimport { delay } from \"redux-saga\";\nimport { put } from \"redux-saga/effects\";\nimport { post } from \"../../modules/api/request\";\nimport TOAST from \"../../modules/toastManager\";\nimport * as actions from \"../actions\";\nimport { takeEvery } from \"redux-saga/effects\";\nimport * as actionTypes from \"../actions/actionTypes\";\nimport StorageUtil from \"../../utils/storageUtil\";\nvar RESOURCE_PREFIX = \"v1/users\";\nexport function watchAuth() {\n  return _regeneratorRuntime().wrap(function watchAuth$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.next = 2;\n        return takeEvery(actionTypes.AUTH_CHECK_TIMEOUT, checkAuthTimeoutSaga);\n      case 2:\n        _context.next = 4;\n        return takeEvery(actionTypes.AUTH_INITIATE_LOGOUT, logoutSaga);\n      case 4:\n        _context.next = 6;\n        return takeEvery(actionTypes.AUTH_USER, authUserSaga);\n      case 6:\n        _context.next = 8;\n        return takeEvery(actionTypes.AUTH_CHECK_STATE, authCheckStateSaga);\n      case 8:\n      case \"end\":\n        return _context.stop();\n    }\n  }, _marked);\n}\nexport function logoutSaga(action) {\n  return _regeneratorRuntime().wrap(function logoutSaga$(_context2) {\n    while (1) switch (_context2.prev = _context2.next) {\n      case 0:\n        _context2.next = 2;\n        return StorageUtil.removeToken();\n      case 2:\n        _context2.next = 4;\n        return StorageUtil.removeExpirationDt();\n      case 4:\n        _context2.next = 6;\n        return StorageUtil.removeUserId();\n      case 6:\n        _context2.next = 8;\n        return put(actions.logoutSucceed());\n      case 8:\n      case \"end\":\n        return _context2.stop();\n    }\n  }, _marked2);\n}\nexport function checkAuthTimeoutSaga(action) {\n  return _regeneratorRuntime().wrap(function checkAuthTimeoutSaga$(_context3) {\n    while (1) switch (_context3.prev = _context3.next) {\n      case 0:\n        _context3.next = 2;\n        return delay(action.expirationTime * 1000);\n      case 2:\n        _context3.next = 4;\n        return put(actions.logout());\n      case 4:\n      case \"end\":\n        return _context3.stop();\n    }\n  }, _marked3);\n}\nexport function authUserSaga(action) {\n  var authData, url, _yield$post, data, expirationDate;\n  return _regeneratorRuntime().wrap(function authUserSaga$(_context4) {\n    while (1) switch (_context4.prev = _context4.next) {\n      case 0:\n        _context4.next = 2;\n        return put(actions.authStart());\n      case 2:\n        authData = {\n          email: action.email,\n          password: action.password,\n          returnSecureToken: true\n        };\n        url = \"\".concat(RESOURCE_PREFIX, \"/login\"); //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=AIzaSyB5cHT6x62tTe-g27vBDIqWcwQWBSj3uiY\";\n        if (!action.isSignup) {\n          url = \"\".concat(RESOURCE_PREFIX, \"/login\");\n          //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaSyB5cHT6x62tTe-g27vBDIqWcwQWBSj3uiY\";\n          //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaS\";\n        }\n        _context4.prev = 5;\n        _context4.next = 8;\n        return post(url, authData, true);\n      case 8:\n        _yield$post = _context4.sent;\n        data = _yield$post.data;\n        if (data.fs_token) {\n          _context4.next = 13;\n          break;\n        }\n        TOAST.error(\"Invalid user\");\n        return _context4.abrupt(\"return\");\n      case 13:\n        _context4.next = 15;\n        return new Date(new Date().getTime() + data.expiresIn * 1000);\n      case 15:\n        expirationDate = _context4.sent;\n        _context4.next = 18;\n        return StorageUtil.setToken(data.fs_token);\n      case 18:\n        _context4.next = 20;\n        return StorageUtil.setExpirationDt(expirationDate);\n      case 20:\n        _context4.next = 22;\n        return StorageUtil.setUser(data.user);\n      case 22:\n        _context4.next = 24;\n        return put(actions.authSuccess(data.fs_token, data.user));\n      case 24:\n        _context4.next = 26;\n        return put(actions.checkAuthTimeout(data.expiresIn));\n      case 26:\n        _context4.next = 32;\n        break;\n      case 28:\n        _context4.prev = 28;\n        _context4.t0 = _context4[\"catch\"](5);\n        _context4.next = 32;\n        return put(actions.authFail(_context4.t0.data.error));\n      case 32:\n      case \"end\":\n        return _context4.stop();\n    }\n  }, _marked4, null, [[5, 28]]);\n}\nexport function authCheckStateSaga(action) {\n  var token, expireDt, expirationDate, userId;\n  return _regeneratorRuntime().wrap(function authCheckStateSaga$(_context5) {\n    while (1) switch (_context5.prev = _context5.next) {\n      case 0:\n        _context5.next = 2;\n        return StorageUtil.getToken(\"fs_token\");\n      case 2:\n        token = _context5.sent;\n        if (token) {\n          _context5.next = 8;\n          break;\n        }\n        _context5.next = 6;\n        return put(actions.logout());\n      case 6:\n        _context5.next = 24;\n        break;\n      case 8:\n        _context5.next = 10;\n        return StorageUtil.getExpirationDt();\n      case 10:\n        expireDt = _context5.sent;\n        expirationDate = new Date(expireDt);\n        if (!(expirationDate <= new Date())) {\n          _context5.next = 17;\n          break;\n        }\n        _context5.next = 15;\n        return put(actions.logout());\n      case 15:\n        _context5.next = 24;\n        break;\n      case 17:\n        _context5.next = 19;\n        return StorageUtil.getUserId();\n      case 19:\n        userId = _context5.sent;\n        _context5.next = 22;\n        return put(actions.authSuccess(token, userId));\n      case 22:\n        _context5.next = 24;\n        return put(actions.checkAuthTimeout((expirationDate.getTime() - new Date().getTime()) / 1000));\n      case 24:\n      case \"end\":\n        return _context5.stop();\n    }\n  }, _marked5);\n}","map":{"version":3,"names":["watchAuth","_marked2","_regeneratorRuntime","mark","logoutSaga","_marked3","checkAuthTimeoutSaga","_marked4","authUserSaga","_marked5","authCheckStateSaga","delay","put","post","TOAST","actions","takeEvery","actionTypes","StorageUtil","RESOURCE_PREFIX","wrap","watchAuth$","_context","prev","next","AUTH_CHECK_TIMEOUT","AUTH_INITIATE_LOGOUT","AUTH_USER","AUTH_CHECK_STATE","stop","_marked","action","logoutSaga$","_context2","removeToken","removeExpirationDt","removeUserId","logoutSucceed","checkAuthTimeoutSaga$","_context3","expirationTime","logout","authData","url","_yield$post","data","expirationDate","authUserSaga$","_context4","authStart","email","password","returnSecureToken","concat","isSignup","sent","fs_token","error","abrupt","Date","getTime","expiresIn","setToken","setExpirationDt","setUser","user","authSuccess","checkAuthTimeout","t0","authFail","token","expireDt","userId","authCheckStateSaga$","_context5","getToken","getExpirationDt","getUserId"],"sources":["/Users/nargelmac/Documents/GitHub/medical-biller/src/store/sagas/auth.js"],"sourcesContent":["import { delay } from \"redux-saga\";\nimport { put } from \"redux-saga/effects\";\n\nimport { post } from \"../../modules/api/request\";\nimport TOAST from \"../../modules/toastManager\";\nimport * as actions from \"../actions\";\nimport { takeEvery } from \"redux-saga/effects\";\nimport * as actionTypes from \"../actions/actionTypes\";\nimport StorageUtil from \"../../utils/storageUtil\";\nconst RESOURCE_PREFIX = \"v1/users\";\n\nexport function* watchAuth() {\n  yield takeEvery(actionTypes.AUTH_CHECK_TIMEOUT, checkAuthTimeoutSaga);\n  yield takeEvery(actionTypes.AUTH_INITIATE_LOGOUT, logoutSaga);\n  yield takeEvery(actionTypes.AUTH_USER, authUserSaga);\n  yield takeEvery(actionTypes.AUTH_CHECK_STATE, authCheckStateSaga);\n}\n\nexport function* logoutSaga(action) {\n  yield StorageUtil.removeToken();\n  yield StorageUtil.removeExpirationDt();\n  yield StorageUtil.removeUserId();\n  yield put(actions.logoutSucceed());\n}\n\nexport function* checkAuthTimeoutSaga(action) {\n  yield delay(action.expirationTime * 1000);\n  yield put(actions.logout());\n}\n\nexport function* authUserSaga(action) {\n  yield put(actions.authStart());\n  const authData = {\n    email: action.email,\n    password: action.password,\n    returnSecureToken: true,\n  };\n\n  let url = `${RESOURCE_PREFIX}/login`;\n\n  //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=AIzaSyB5cHT6x62tTe-g27vBDIqWcwQWBSj3uiY\";\n  if (!action.isSignup) {\n    url = `${RESOURCE_PREFIX}/login`;\n    //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaSyB5cHT6x62tTe-g27vBDIqWcwQWBSj3uiY\";\n    //\"https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaS\";\n  }\n  try {\n    //const response = yield axios(options);\n    const { data } = yield post(url, authData, true);\n    if (!data.fs_token) {\n      TOAST.error(\"Invalid user\");\n      return;\n    }\n    const expirationDate = yield new Date(\n      new Date().getTime() + data.expiresIn * 1000\n    );\n\n    yield StorageUtil.setToken(data.fs_token);\n    yield StorageUtil.setExpirationDt(expirationDate);\n    yield StorageUtil.setUser(data.user);\n    yield put(actions.authSuccess(data.fs_token, data.user));\n    yield put(actions.checkAuthTimeout(data.expiresIn));\n  } catch (error) {\n    yield put(actions.authFail(error.data.error));\n  }\n}\n\nexport function* authCheckStateSaga(action) {\n  const token = yield StorageUtil.getToken(\"fs_token\");\n  if (!token) {\n    yield put(actions.logout());\n  } else {\n    const expireDt = yield StorageUtil.getExpirationDt();\n    const expirationDate = new Date(expireDt);\n    if (expirationDate <= new Date()) {\n      yield put(actions.logout());\n    } else {\n      const userId = yield StorageUtil.getUserId();\n      yield put(actions.authSuccess(token, userId));\n      yield put(\n        actions.checkAuthTimeout(\n          (expirationDate.getTime() - new Date().getTime()) / 1000\n        )\n      );\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}